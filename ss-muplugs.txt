#!/bin/bash

####################################################################################################
#### author: SlickStack ############################################################################
#### link: https://slickstack.io ###################################################################
#### mirror: http://lemp.redshift.network/ss-muplugs.txt ###########################################
#### path: /var/www/ss-muplugs #####################################################################
#### destination: n/a (not a boilerplate) ##########################################################
#### purpose: Reinstalls various MU (Must-Use) plugins and object cache, etc (idempotent) ##########
#### module version: Ubuntu 18.04 LTS + various LittleBizzy plugins ################################
####################################################################################################

## SLICKSTACK SUPPORTS CUSTOMIZING MU PLUGINS BUT REQUIRES A FEW OF OUR OWN SCRIPTS ##

## include SlickStack configuration ##
source /var/www/ss-config

####################################################################################################
#### SlickStack: Critical Bash Functions (Aliases) For This Script To Work #########################
####################################################################################################

## apt alias flags ##
function apt {
    export DEBIAN_FRONTEND=noninteractive
    export DEBIAN_PRIORITY=critical
    export PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'
    command /usr/bin/apt -q -y -o Dpkg::Options::=--force-confold -o Dpkg::Options::=--force-confdef "$@"
}

## add-apt-repository alias flags ##
function add-apt-repository {
    export DEBIAN_FRONTEND=noninteractive
    export DEBIAN_PRIORITY=critical
    export PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'
    command /usr/bin/add-apt-repository -y "$@"
}

## wget alias flags ##
function wget {
    command wget --no-check-certificate --no-cache --no-cookies --tries=3 --timeout=15 "$@"
}

## cp alias flags ##
function cp {
    command cp -R -f -d --no-preserve=mode,ownership "$@"
}

## mkdir alias flags ##
function mkdir {
    command mkdir -p "$@"
}

## unzip alias flags ##
function unzip {
    command unzip -o "$@"
}

## rm alias flags ##
function rm {
    command rm -R -f "$@"
}

## ln alias flags ##
function ln {
    command ln -s -f "$@"
}

####################################################################################################
#### SS-Muplugs: Delete Any Previous (Leftover) Temporary Files ####################################
####################################################################################################

## delete Autoloader (required script) temporary files ##
rm /tmp/autoloader*

## delete Custom Functions ##
rm /tmp/custom-functions*
rm /tmp/functions*


## delete Object Cache (required drop-in plugin) temporary files ##
rm /tmp/object-cache*

## delete (default) MU plugins temporary files ##
rm /tmp/clear-caches*
rm /tmp/cloudflare*
rm /tmp/dashboard-cleanup*
rm /tmp/delete-expired-transients*
rm /tmp/disable-attachment-pages*
rm /tmp/disable-embeds*
rm /tmp/disable-emojis*
rm /tmp/disable-empty-trash*
rm /tmp/disable-gutenberg*
rm /tmp/disable-image-compression*
rm /tmp/disable-post-via-email*
rm /tmp/disable-xml-rpc*
rm /tmp/force-https*
rm /tmp/force-strong-hashing*
rm /tmp/header-cleanup*
rm /tmp/index-autoload*
rm /tmp/limit-heartbeat*
rm /tmp/maintenance-mode*
rm /tmp/minify-html*
rm /tmp/remove-query-strings*
rm /tmp/server-status*
rm /tmp/sftp-details*
rm /tmp/virtual-robotstxt*

## delete (custom) MU plugins temporary files ##
# (coming soon)

####################################################################################################
#### SS-Muplugs: Ensure MU (Must-Use) Directory Exists + Delete Current MU Plugins #################
####################################################################################################

## ensure MU (Must-Use) plugins directory exists ##
mkdir /var/www/html/wp-content/mu-plugins

## delete all currently installed MU (Must-Use) plugins ##
rm /var/www/html/wp-content/mu-plugins/*

####################################################################################################
#### SS-Muplugs: Install Required MU (Must-Use) Plugins + Object Cache #############################
####################################################################################################

## download Autoloader (required script) files ##
wget -O /tmp/autoloader.php http://lemp.redshift.network/mu-plugins/autoloader.txt

## download Custom Functions files ##
wget -O /tmp/custom-functions.zip http://lemp.redshift.network/mu-plugins/custom-functions.zip

## download Object Cache (required drop-in plugin) files ##
wget -O /tmp/object-cache.php http://lemp.redshift.network/mu-plugins/object-cache.txt

## unzip various files ##
unzip /tmp/custom-functions.zip -d /tmp

## delete potentially conflicting Autoloader scripts ##
rm /var/www/html/wp-content/plugins/autoloader*

## delete potentially conflicting normal plugins (with required MU plugins) ##
# rm /var/www/html/wp-content/plugins/custom-functions* ## don't delete others until ours is working 100% perfect


## delete potentially conflicting object caches (drop-in plugins + normal plugins) ##
rm /var/www/html/wp-content/object-cache*
rm /var/www/html/wp-content/plugins/memcache*
rm /var/www/html/wp-content/plugins/memcached*
rm /var/www/html/wp-content/plugins/object-cache*
rm /var/www/html/wp-content/plugins/redis*

## copy Autoloader files to destination ##
cp /tmp/autoloader.php /var/www/html/wp-content/mu-plugins/autoloader.php

## copy required MU plugins files to destinations ##
cp /tmp/custom-functions /var/www/html/wp-content/mu-plugins/custom-functions

## copy Object Cache files to destination ##
cp /tmp/object-cache.php /var/www/html/wp-content/object-cache.php

####################################################################################################
#### SS-Muplugs: Configure Custom Functions (MU) Plugin (Required) #################################
####################################################################################################

## download specified functions file (otherwise create generic) if none exists ##
if [ ! -f /var/www/html/wp-content/functions.php ] && [ -z "$CUSTOM_FUNCTIONS_SOURCE" ]; then
    wget -O /tmp/functions.php http://lemp.redshift.network/wordpress/functions.txt
    cp /tmp/functions.php /var/www/html/wp-content/functions.php
elif [ ! -f /var/www/html/wp-content/functions.php ] && [ -n "$CUSTOM_FUNCTIONS_SOURCE" ]; then
    wget -O /tmp/functions.php "$CUSTOM_FUNCTIONS_SOURCE"
    cp /tmp/functions.php /var/www/html/wp-content/functions.php
fi

####################################################################################################
#### SS-Muplugs: Install Specified MU (Must-Use) Plugins (Optional) ################################
####################################################################################################

## download latest specified MU (Must-Use) files as defined in the ss-config ##
# if [ -n "$MU_PLUGIN_01_SOURCE" ] && [ -n "$MU_PLUGIN_01_DIR" ]; then
# wget -O /tmp/$MU_PLUGIN_01_DIR.zip $MU_PLUGIN_01_SOURCE
# wget -O /tmp/$MU_PLUGIN_02_DIR.zip $MU_PLUGIN_02_SOURCE
# wget -O /tmp/$MU_PLUGIN_03_DIR.zip $MU_PLUGIN_03_SOURCE
# wget -O /tmp/$MU_PLUGIN_04_DIR.zip $MU_PLUGIN_04_SOURCE
# wget -O /tmp/$MU_PLUGIN_05_DIR.zip $MU_PLUGIN_05_SOURCE
# wget -O /tmp/$MU_PLUGIN_06_DIR.zip $MU_PLUGIN_06_SOURCE
# wget -O /tmp/$MU_PLUGIN_07_DIR.zip $MU_PLUGIN_07_SOURCE
# wget -O /tmp/$MU_PLUGIN_08_DIR.zip $MU_PLUGIN_08_SOURCE
# wget -O /tmp/$MU_PLUGIN_09_DIR.zip $MU_PLUGIN_09_SOURCE
# wget -O /tmp/$MU_PLUGIN_10_DIR.zip $MU_PLUGIN_10_SOURCE
# wget -O /tmp/$MU_PLUGIN_11_DIR.zip $MU_PLUGIN_11_SOURCE
# wget -O /tmp/$MU_PLUGIN_12_DIR.zip $MU_PLUGIN_12_SOURCE
# wget -O /tmp/$MU_PLUGIN_13_DIR.zip $MU_PLUGIN_13_SOURCE
# wget -O /tmp/$MU_PLUGIN_14_DIR.zip $MU_PLUGIN_14_SOURCE
# wget -O /tmp/$MU_PLUGIN_15_DIR.zip $MU_PLUGIN_15_SOURCE
# wget -O /tmp/$MU_PLUGIN_16_DIR.zip $MU_PLUGIN_16_SOURCE
# wget -O /tmp/$MU_PLUGIN_17_DIR.zip $MU_PLUGIN_17_SOURCE
# wget -O /tmp/$MU_PLUGIN_18_DIR.zip $MU_PLUGIN_18_SOURCE
# wget -O /tmp/$MU_PLUGIN_19_DIR.zip $MU_PLUGIN_19_SOURCE
# wget -O /tmp/$MU_PLUGIN_20_DIR.zip $MU_PLUGIN_20_SOURCE
# wget -O /tmp/$MU_PLUGIN_21_DIR.zip $MU_PLUGIN_21_SOURCE
# wget -O /tmp/$MU_PLUGIN_22_DIR.zip $MU_PLUGIN_22_SOURCE
# wget -O /tmp/$MU_PLUGIN_23_DIR.zip $MU_PLUGIN_23_SOURCE
# wget -O /tmp/$MU_PLUGIN_24_DIR.zip $MU_PLUGIN_24_SOURCE
# wget -O /tmp/$MU_PLUGIN_25_DIR.zip $MU_PLUGIN_25_SOURCE
# wget -O /tmp/$MU_PLUGIN_26_DIR.zip $MU_PLUGIN_26_SOURCE
# wget -O /tmp/$MU_PLUGIN_27_DIR.zip $MU_PLUGIN_27_SOURCE
# wget -O /tmp/$MU_PLUGIN_28_DIR.zip $MU_PLUGIN_28_SOURCE
# wget -O /tmp/$MU_PLUGIN_29_DIR.zip $MU_PLUGIN_29_SOURCE
# wget -O /tmp/$MU_PLUGIN_30_DIR.zip $MU_PLUGIN_30_SOURCE
# wget -O /tmp/$MU_PLUGIN_31_DIR.zip $MU_PLUGIN_31_SOURCE
# wget -O /tmp/$MU_PLUGIN_32_DIR.zip $MU_PLUGIN_32_SOURCE
# wget -O /tmp/$MU_PLUGIN_33_DIR.zip $MU_PLUGIN_33_SOURCE
# wget -O /tmp/$MU_PLUGIN_34_DIR.zip $MU_PLUGIN_34_SOURCE
# wget -O /tmp/$MU_PLUGIN_35_DIR.zip $MU_PLUGIN_35_SOURCE
# wget -O /tmp/$MU_PLUGIN_36_DIR.zip $MU_PLUGIN_36_SOURCE
# wget -O /tmp/$MU_PLUGIN_37_DIR.zip $MU_PLUGIN_37_SOURCE
# wget -O /tmp/$MU_PLUGIN_38_DIR.zip $MU_PLUGIN_38_SOURCE
# wget -O /tmp/$MU_PLUGIN_39_DIR.zip $MU_PLUGIN_39_SOURCE
# wget -O /tmp/$MU_PLUGIN_40_DIR.zip $MU_PLUGIN_40_SOURCE
# wget -O /tmp/$MU_PLUGIN_41_DIR.zip $MU_PLUGIN_41_SOURCE
# wget -O /tmp/$MU_PLUGIN_42_DIR.zip $MU_PLUGIN_42_SOURCE
# wget -O /tmp/$MU_PLUGIN_43_DIR.zip $MU_PLUGIN_43_SOURCE
# wget -O /tmp/$MU_PLUGIN_44_DIR.zip $MU_PLUGIN_44_SOURCE
# wget -O /tmp/$MU_PLUGIN_45_DIR.zip $MU_PLUGIN_45_SOURCE
# wget -O /tmp/$MU_PLUGIN_46_DIR.zip $MU_PLUGIN_46_SOURCE
# wget -O /tmp/$MU_PLUGIN_47_DIR.zip $MU_PLUGIN_47_SOURCE
# wget -O /tmp/$MU_PLUGIN_48_DIR.zip $MU_PLUGIN_48_SOURCE
# wget -O /tmp/$MU_PLUGIN_49_DIR.zip $MU_PLUGIN_49_SOURCE
# wget -O /tmp/$MU_PLUGIN_50_DIR.zip $MU_PLUGIN_50_SOURCE
# wget -O /tmp/$MU_PLUGIN_51_DIR.zip $MU_PLUGIN_51_SOURCE
# wget -O /tmp/$MU_PLUGIN_52_DIR.zip $MU_PLUGIN_52_SOURCE
# wget -O /tmp/$MU_PLUGIN_53_DIR.zip $MU_PLUGIN_53_SOURCE
# wget -O /tmp/$MU_PLUGIN_54_DIR.zip $MU_PLUGIN_54_SOURCE
# wget -O /tmp/$MU_PLUGIN_55_DIR.zip $MU_PLUGIN_55_SOURCE
# wget -O /tmp/$MU_PLUGIN_56_DIR.zip $MU_PLUGIN_56_SOURCE
# wget -O /tmp/$MU_PLUGIN_57_DIR.zip $MU_PLUGIN_57_SOURCE
# wget -O /tmp/$MU_PLUGIN_58_DIR.zip $MU_PLUGIN_58_SOURCE
# wget -O /tmp/$MU_PLUGIN_59_DIR.zip $MU_PLUGIN_59_SOURCE
# wget -O /tmp/$MU_PLUGIN_60_DIR.zip $MU_PLUGIN_60_SOURCE
# wget -O /tmp/$MU_PLUGIN_61_DIR.zip $MU_PLUGIN_61_SOURCE
# wget -O /tmp/$MU_PLUGIN_62_DIR.zip $MU_PLUGIN_62_SOURCE
# wget -O /tmp/$MU_PLUGIN_63_DIR.zip $MU_PLUGIN_63_SOURCE
# wget -O /tmp/$MU_PLUGIN_64_DIR.zip $MU_PLUGIN_64_SOURCE
# wget -O /tmp/$MU_PLUGIN_65_DIR.zip $MU_PLUGIN_65_SOURCE
# wget -O /tmp/$MU_PLUGIN_66_DIR.zip $MU_PLUGIN_66_SOURCE
# wget -O /tmp/$MU_PLUGIN_67_DIR.zip $MU_PLUGIN_67_SOURCE
# wget -O /tmp/$MU_PLUGIN_68_DIR.zip $MU_PLUGIN_68_SOURCE
# wget -O /tmp/$MU_PLUGIN_69_DIR.zip $MU_PLUGIN_69_SOURCE
# wget -O /tmp/$MU_PLUGIN_70_DIR.zip $MU_PLUGIN_70_SOURCE
# wget -O /tmp/$MU_PLUGIN_71_DIR.zip $MU_PLUGIN_71_SOURCE
# wget -O /tmp/$MU_PLUGIN_72_DIR.zip $MU_PLUGIN_72_SOURCE
# wget -O /tmp/$MU_PLUGIN_73_DIR.zip $MU_PLUGIN_73_SOURCE
# wget -O /tmp/$MU_PLUGIN_74_DIR.zip $MU_PLUGIN_74_SOURCE
# wget -O /tmp/$MU_PLUGIN_75_DIR.zip $MU_PLUGIN_75_SOURCE
# wget -O /tmp/$MU_PLUGIN_76_DIR.zip $MU_PLUGIN_76_SOURCE
# wget -O /tmp/$MU_PLUGIN_77_DIR.zip $MU_PLUGIN_77_SOURCE
# wget -O /tmp/$MU_PLUGIN_78_DIR.zip $MU_PLUGIN_78_SOURCE
# wget -O /tmp/$MU_PLUGIN_79_DIR.zip $MU_PLUGIN_79_SOURCE
# wget -O /tmp/$MU_PLUGIN_80_DIR.zip $MU_PLUGIN_80_SOURCE
# wget -O /tmp/$MU_PLUGIN_81_DIR.zip $MU_PLUGIN_81_SOURCE
# wget -O /tmp/$MU_PLUGIN_82_DIR.zip $MU_PLUGIN_82_SOURCE
# wget -O /tmp/$MU_PLUGIN_83_DIR.zip $MU_PLUGIN_83_SOURCE
# wget -O /tmp/$MU_PLUGIN_84_DIR.zip $MU_PLUGIN_84_SOURCE
# wget -O /tmp/$MU_PLUGIN_85_DIR.zip $MU_PLUGIN_85_SOURCE
# wget -O /tmp/$MU_PLUGIN_86_DIR.zip $MU_PLUGIN_86_SOURCE
# wget -O /tmp/$MU_PLUGIN_87_DIR.zip $MU_PLUGIN_87_SOURCE
# wget -O /tmp/$MU_PLUGIN_88_DIR.zip $MU_PLUGIN_88_SOURCE
# wget -O /tmp/$MU_PLUGIN_89_DIR.zip $MU_PLUGIN_89_SOURCE
# wget -O /tmp/$MU_PLUGIN_90_DIR.zip $MU_PLUGIN_90_SOURCE
# wget -O /tmp/$MU_PLUGIN_91_DIR.zip $MU_PLUGIN_91_SOURCE
# wget -O /tmp/$MU_PLUGIN_92_DIR.zip $MU_PLUGIN_92_SOURCE
# wget -O /tmp/$MU_PLUGIN_93_DIR.zip $MU_PLUGIN_93_SOURCE
# wget -O /tmp/$MU_PLUGIN_94_DIR.zip $MU_PLUGIN_94_SOURCE
# wget -O /tmp/$MU_PLUGIN_95_DIR.zip $MU_PLUGIN_95_SOURCE
# wget -O /tmp/$MU_PLUGIN_96_DIR.zip $MU_PLUGIN_96_SOURCE
# wget -O /tmp/$MU_PLUGIN_97_DIR.zip $MU_PLUGIN_97_SOURCE
# wget -O /tmp/$MU_PLUGIN_98_DIR.zip $MU_PLUGIN_98_SOURCE
# wget -O /tmp/$MU_PLUGIN_99_DIR.zip $MU_PLUGIN_99_SOURCE 
# else

## download default MU (Must-Use) files if none specified in the ss-config ##
wget -O /tmp/clear-caches.zip http://lemp.redshift.network/mu-plugins/clear-caches.zip
wget -O /tmp/cloudflare.zip http://lemp.redshift.network/mu-plugins/cloudflare.zip
wget -O /tmp/dashboard-cleanup.zip http://lemp.redshift.network/mu-plugins/dashboard-cleanup.zip
wget -O /tmp/delete-expired-transients.zip http://lemp.redshift.network/mu-plugins/delete-expired-transients.zip
wget -O /tmp/disable-attachment-pages.zip http://lemp.redshift.network/mu-plugins/disable-attachment-pages.zip
wget -O /tmp/disable-embeds.zip http://lemp.redshift.network/mu-plugins/disable-embeds.zip
wget -O /tmp/disable-emojis.zip http://lemp.redshift.network/mu-plugins/disable-emojis.zip
wget -O /tmp/disable-empty-trash.zip http://lemp.redshift.network/mu-plugins/disable-empty-trash.zip
wget -O /tmp/disable-gutenberg.zip http://lemp.redshift.network/mu-plugins/disable-gutenberg.zip
wget -O /tmp/disable-image-compression.zip http://lemp.redshift.network/mu-plugins/disable-image-compression.zip
wget -O /tmp/disable-post-via-email.zip http://lemp.redshift.network/mu-plugins/disable-post-via-email.zip
wget -O /tmp/disable-xml-rpc.zip http://lemp.redshift.network/mu-plugins/disable-xml-rpc.zip
wget -O /tmp/error-log-monitor.zip http://lemp.redshift.network/mu-plugins/error-log-monitor.zip
wget -O /tmp/force-https.zip http://lemp.redshift.network/mu-plugins/force-https.zip
wget -O /tmp/force-strong-hashing.zip http://lemp.redshift.network/mu-plugins/force-strong-hashing.zip
wget -O /tmp/header-cleanup.zip http://lemp.redshift.network/mu-plugins/header-cleanup.zip
wget -O /tmp/limit-heartbeat.zip http://lemp.redshift.network/mu-plugins/limit-heartbeat.zip
wget -O /tmp/maintenance-mode.zip http://lemp.redshift.network/mu-plugins/maintenance-mode.zip
wget -O /tmp/minify-html.zip http://lemp.redshift.network/mu-plugins/minify-html.zip
wget -O /tmp/plugin-blacklist.zip http://lemp.redshift.network/mu-plugins/plugin-blacklist.zip
wget -O /tmp/server-status.zip http://lemp.redshift.network/mu-plugins/server-status.zip
wget -O /tmp/sftp-details.zip http://lemp.redshift.network/mu-plugins/sftp-details.zip
wget -O /tmp/virtual-robotstxt.zip http://lemp.redshift.network/mu-plugins/virtual-robotstxt.zip

## unzip them all ##
unzip /tmp/clear-caches.zip -d /tmp
unzip /tmp/cloudflare.zip -d /tmp
unzip /tmp/dashboard-cleanup.zip -d /tmp
unzip /tmp/delete-expired-transients.zip -d /tmp
unzip /tmp/disable-attachment-pages.zip -d /tmp
unzip /tmp/disable-embeds.zip -d /tmp
unzip /tmp/disable-emojis.zip -d /tmp
unzip /tmp/disable-empty-trash.zip -d /tmp
unzip /tmp/disable-gutenberg.zip -d /tmp
unzip /tmp/disable-image-compression.zip -d /tmp
unzip /tmp/disable-post-via-email.zip -d /tmp
unzip /tmp/disable-xml-rpc.zip -d /tmp
unzip /tmp/force-https.zip -d /tmp
unzip /tmp/force-strong-hashing.zip -d /tmp
unzip /tmp/header-cleanup.zip -d /tmp
unzip /tmp/index-autoload.zip -d /tmp
unzip /tmp/limit-heartbeat.zip -d /tmp
unzip /tmp/maintenance-mode.zip -d /tmp
unzip /tmp/minify-html.zip -d /tmp
unzip /tmp/server-status.zip -d /tmp
unzip /tmp/sftp-details.zip -d /tmp
unzip /tmp/virtual-robotstxt.zip -d /tmp

## delete plugins instances (conflicting namespaces or previous namespaces) ##
rm /var/www/html/wp-content/plugins/clear-caches*
rm /var/www/html/wp-content/plugins/cloudflare*
rm /var/www/html/wp-content/plugins/cf-littlebizzy* ## previous CloudFlare namespace
rm /var/www/html/wp-content/plugins/dashboard-cleanup*
rm /var/www/html/wp-content/plugins/delete-expired-transients*
rm /var/www/html/wp-content/plugins/disable-attachment-pages*
rm /var/www/html/wp-content/plugins/disable-embeds*
rm /var/www/html/wp-content/plugins/disable-emojis*
rm /var/www/html/wp-content/plugins/disable-empty-trash*
rm /var/www/html/wp-content/plugins/disable-gutenberg*
rm /var/www/html/wp-content/plugins/disable-image-compression*
rm /var/www/html/wp-content/plugins/disable-post-via-email*
rm /var/www/html/wp-content/plugins/disable-xml-rpc*
rm /var/www/html/wp-content/plugins/force-https*
rm /var/www/html/wp-content/plugins/force-strong-hashing*
rm /var/www/html/wp-content/plugins/header-cleanup*
rm /var/www/html/wp-content/plugins/index-autoload*
rm /var/www/html/wp-content/plugins/limit-heartbeat*
rm /var/www/html/wp-content/plugins/maintenance-mode*
rm /var/www/html/wp-content/plugins/minify-html*
rm /var/www/html/wp-content/plugins/purge-them-all* ## previous Clear Caches namespace
rm /var/www/html/wp-content/plugins/remove-query-strings*
rm /var/www/html/wp-content/plugins/server-status*
rm /var/www/html/wp-content/plugins/sftp-details*
rm /var/www/html/wp-content/plugins/virtual-robotstxt*

## copy to destination ##
cp /tmp/clear-caches /var/www/html/wp-content/mu-plugins/clear-caches
cp /tmp/cloudflare /var/www/html/wp-content/mu-plugins/cloudflare
cp /tmp/dashboard-cleanup /var/www/html/wp-content/mu-plugins/dashboard-cleanup
cp /tmp/delete-expired-transients /var/www/html/wp-content/mu-plugins/delete-expired-transients
cp /tmp/disable-attachment-pages /var/www/html/wp-content/mu-plugins/disable-attachment-pages
cp /tmp/disable-embeds /var/www/html/wp-content/mu-plugins/disable-embeds
cp /tmp/disable-emojis /var/www/html/wp-content/mu-plugins/disable-emojis
cp /tmp/disable-empty-trash /var/www/html/wp-content/mu-plugins/disable-empty-trash
cp /tmp/disable-gutenberg /var/www/html/wp-content/mu-plugins/disable-gutenberg
cp /tmp/disable-image-compression /var/www/html/wp-content/mu-plugins/disable-image-compression
cp /tmp/disable-post-via-email /var/www/html/wp-content/mu-plugins/disable-post-via-email
cp /tmp/disable-xml-rpc /var/www/html/wp-content/mu-plugins/disable-xml-rpc
cp /tmp/force-https /var/www/html/wp-content/mu-plugins/force-https
cp /tmp/force-strong-hashing /var/www/html/wp-content/mu-plugins/force-strong-hashing
cp /tmp/header-cleanup /var/www/html/wp-content/mu-plugins/header-cleanup
cp /tmp/limit-heartbeat /var/www/html/wp-content/mu-plugins/limit-heartbeat
cp /tmp/maintenance-mode /var/www/html/wp-content/mu-plugins/maintenance-mode
cp /tmp/minify-html /var/www/html/wp-content/mu-plugins/minify-html
cp /tmp/server-status /var/www/html/wp-content/mu-plugins/server-status
cp /tmp/sftp-details /var/www/html/wp-content/mu-plugins/sftp-details
cp /tmp/virtual-robotstxt /var/www/html/wp-content/mu-plugins/virtual-robotstxt

## end if ##
# fi

####################################################################################################
#### SS-Muplugs: Reset Permissions #################################################################
####################################################################################################

chown -R www-data:wordpress /var/www/html/wp-content/mu-plugins
chown -R www-data:wordpress /var/www/html/wp-content/object-cache.php
chown $SFTP_USER:wordpress /var/www/html/wp-content/functions.php
find /var/www/html/wp-content/mu-plugins/ -type d -exec chmod 775 {} \;
find /var/www/html/wp-content/mu-plugins/ -type f -exec chmod 664 {} \;
chmod 664 /var/www/html/wp-content/object-cache.php
chmod 6775 /var/www/html/wp-content/functions.php

####################################################################################################
#### SS-Muplugs: Delete Any Previous (Leftover) Temporary Files ####################################
####################################################################################################

## delete Autoloader (required script) temporary files ##
rm /tmp/autoloader*

## delete Custom Functions temporary files ##
rm /tmp/custom-functions*
rm /tmp/functions*

## delete Object Cache (required drop-in plugin) temporary files ##
rm /tmp/object-cache*

## delete (default) MU plugins temporary files ##
rm /tmp/clear-caches*
rm /tmp/cloudflare*
rm /tmp/dashboard-cleanup*
rm /tmp/delete-expired-transients*
rm /tmp/disable-attachment-pages*
rm /tmp/disable-embeds*
rm /tmp/disable-emojis*
rm /tmp/disable-empty-trash*
rm /tmp/disable-gutenberg*
rm /tmp/disable-image-compression*
rm /tmp/disable-post-via-email*
rm /tmp/disable-xml-rpc*
rm /tmp/force-https*
rm /tmp/force-strong-hashing*
rm /tmp/header-cleanup*
rm /tmp/index-autoload*
rm /tmp/limit-heartbeat*
rm /tmp/maintenance-mode*
rm /tmp/minify-html*
rm /tmp/remove-query-strings*
rm /tmp/server-status*
rm /tmp/sftp-details*
rm /tmp/virtual-robotstxt*

## delete (custom) MU plugins temporary files ##
# (coming soon)

####################################################################################################
#### SS-Muplugs: Reset PHP OPcache (Bash Script Workaround) ########################################
####################################################################################################

## creative way to reset OPcache using temporary PHP script ##
RANDOM_RESET_OPCACHE=$(openssl rand -hex 12)
echo "<?php opcache_reset(); ?>" > /var/www/html/purge-${RANDOM_RESET_OPCACHE}.php
/usr/bin/php /var/www/html/purge-${RANDOM_RESET_OPCACHE}.php
rm /var/www/html/purge-${RANDOM_RESET_OPCACHE}.php

####################################################################################################
#### SS-Muplugs: Flush Redis Object Cache ##########################################################
####################################################################################################

## flush Redis server (suppress CLI messages) ##
redis-cli flushall &> /dev/null

####################################################################################################
#### SlickStack: External References Used To Improve This Script (Thanks, Interwebz) ###############
####################################################################################################

## Ref: https://unix.stackexchange.com/questions/368246/cant-use-alias-in-script-even-if-i-define-it-just-above
