<?php
/*
Plugin Name: 000 Common
Plugin URI: https://slickstack.io/modules/wordpress/mu-plugins
Description: MU plugin for SlickStack servers
Version: 0.0.0
Author: SlickStack
Author URI: https://slickstack.io
License: GPLv3
License URI: http://www.gnu.org/licenses/gpl-3.0.html
*/

/** THIS LIGHTWEIGHT PHP SCRIPT HAS NO SQL QUERIES AND UPDATES DIRECTLY VIA SLICKSTACK */
/** IT IS A REQUIRED MU (MUST-USE) PLUGIN FOR SLICKSTACK (DO NOT REMOVE IT) */

/** ********************************************************************************************* */
/** TABLE OF CONTENTS (000 Common) ************************************************************** */
/** ********************************************************************************************* */

/** this is a brief summary of the different code snippets you will find in this script */
/** each section should be commented so you understand what is being accomplished */

// A. WP Login Messages
// B. WP Admin Dashboard Widget
// C. WP Admin Notices (Production)
// D. WP Admin Notices (Staging)
// E. WP Admin Notices (Development)

// F. SlickStack Dashboard

// G. Disk Space Warning (WP Admin Notice)
// H. PENDING: PHP Hacks Warning (WP Admin Notice)
// I. Switch Environment Menu
// J. WP Admin Toolbar Menu

/** ********************************************************************************************* */
/** A. 000 Common: WP Login Messages ************************************************************ */
/** ********************************************************************************************* */

/** this is a brief login page welcome message that we use to announce important things */
/** most of the time this feature will only be activated in case of emergencies */

// production
if ( defined( 'WP_ENVIRONMENT_TYPE' ) && WP_ENVIRONMENT_TYPE == 'production' ) {

    function ss_login_message_production() {
        return '<p class="message">Having trouble logging in? Please clear all cookies for this site and then try again (we use secure cookie rules). The default username and password should be the same as your SFTP credentials, until you change them. &mdash; <em>SlickStack</em></p>';
    }

    add_filter( 'login_message', 'ss_login_message_production' );

}

// staging
if ( defined( 'WP_ENVIRONMENT_TYPE' ) && WP_ENVIRONMENT_TYPE == 'staging' ) {

    function ss_login_message_staging() {
        return '<p class="message">Having trouble logging in? Please clear all cookies for this site and then try again (we use secure cookie rules). The default username and password should be the same as your SFTP credentials, until you change them. &mdash; <em>SlickStack</em></p>';
    }

    add_filter( 'login_message', 'ss_login_message_staging' );

}

// development
if ( defined( 'WP_ENVIRONMENT_TYPE' ) && WP_ENVIRONMENT_TYPE == 'development' ) {

    function ss_login_message_development() {
        return '<p class="message">Having trouble logging in? Please clear all cookies for this site and then try again (we use secure cookie rules). The default username and password should be the same as your SFTP credentials, until you change them. &mdash; <em>SlickStack</em></p>';
    }

    add_filter( 'login_message', 'ss_login_message_development' );

}

/** ********************************************************************************************* */
/** B. 000 Common: WP Admin Dashboard Widget **************************************************** */
/** ********************************************************************************************* */

add_action( 'wp_dashboard_setup', 'ss_dashboard_widgets' );

function ss_dashboard_widgets() {
    wp_add_dashboard_widget( 'ss_overview_widget', 'SlickStack Status', 'ss_overview_widget_content' );
}

function ss_overview_widget_content() {
    echo '<table class="striped"><tbody>
    <tr><td><strong>Virtualization Technology:</strong> <span>' . SYSTEM_VIRTUAL . '</span></td></tr>
    <tr><td><strong>Linux Kernel:</strong> <span>' . SYSTEM_LINUX_KERNEL . '</span></td></tr>
    <tr><td><strong>Operating System:</strong> <span>' . SYSTEM_OS_PRETTY_NAME . '</span></td></tr>
    <tr><td><strong>IPv4 Address:</strong> <span>' . SYSTEM_IPV4_ADDRESS . '</span></td></tr>
    <tr><td><strong>IPv6 Address:</strong> <span>' . SYSTEM_IPV6_ADDRESS . '</span></td></tr>
    <tr><td><strong>Hostname:</strong> <span>' . SYSTEM_HOSTNAME . '</span></td></tr>
    <tr><td><strong>Disk Space:</strong> <span>' . SYSTEM_DISK_FREE_EASY . ' free space out of ' . SYSTEM_DISK_TOTAL_EASY . ' total space (' . SYSTEM_DISK_USED_PERCENT . ' used)</span></td></tr>
    <tr><td><strong>vCPU Cores:</strong> <span>' . SYSTEM_CPU_CORES . '</span></td></tr>
    <tr><td><strong>Nginx Version:</strong> <span>' . SYSTEM_SERVER_SOFTWARE . '</span></td></tr>
    <tr><td><strong>PHP Version:</strong> <span>' . SYSTEM_PHP_VERSION . '</span></td></tr>
    <tr><td><strong>PHP Extensions:</strong> <span>' . SYSTEM_PHP_EXTENSIONS . '</span></td></tr>
    <tr><td><strong>MySQL Version:</strong> <span>' . SYSTEM_MYSQL_VERSION . '</span></td></tr>
    <tr><td><strong>MySQL Database Size:</strong> <span>' . SYSTEM_MYSQL_SIZE . '</span></td></tr>
    <tr><td><strong>Document Root:</strong> <span>/var/www/html</span></td></tr>
    </tbody></table>';
}

/** ********************************************************************************************* */
/** C. 000 Common: WP Admin Notices (Production) ************************************************ */
/** ********************************************************************************************* */

/** this is a dynamic notice that is force displayed on the WP Admin backend screen */
/** we use this to announce occasional updates and other critical information */

// if ( is_main_site() || !is_multisite() ) {
//    add_action( 'admin_notices', 'ss_admin_notice_production' );
// }

function ss_admin_notice_production() {

    $current_user = wp_get_current_user();
    if ( current_user_can( 'manage_options' ) ) { ?>
    
        <div class="notice notice-info">
        <p><strong>Help SlickStack reach 10+ reviews on G2 Crowd</strong></p>
        <p>We hope you are enjoying SlickStack, and the stability and security that it brings to your WordPress cloud server. As a free software project, the only way we grow is by word of mouth. Please consider leaving an honest review on <a href="https://www.g2.com/products/slickstack/reviews"><strong>G2 Crowd</strong></a> if you would like our project to continue growing and getting better for years to come... your encouragement and feedback is truly the only thing keeping us going. And thank you very much, ahead of time!</p>
        <div style="width:100%;height:auto;margin:12px 0px;padding:0;background:#F6F7F7;">
            <div style="text-align:left;padding:12px;width:80%;background:#E6E7E7;">
                <h3>8/10 reviews... thank you so much!&nbsp;&nbsp;<a href="https://www.g2.com/products/slickstack/reviews" style="text-decoration:underline;">Leave a review&nbsp;&raquo;</a></h3>
            </div>
        </div>
        <p><em>This message will disappear automatically after we achieve our goal, thank you. — SlickStack</em></p>
        </div>
    
    <?php } else { }

}

// if( is_main_site() || !is_multisite() ) {
//     add_action( 'admin_notices', 'ss_admin_notice_production2' );
// }

function ss_admin_notice_production2() {

    $current_user = wp_get_current_user();
    if ( current_user_can( 'manage_options' ) ) { ?>
    
        <div class="notice notice-info">
        
        <p><strong>Please consider donating</strong></p>
        
        <p>If you are seeing this message, it's because your WordPress website is using <a href="https://slickstack.io/"><strong>SlickStack</strong></a>, a free and open source script designed to optimize cloud servers for incredible performance, security, and SEO signals. Many of you have been able to save a lot of money by moving your website(s) away from over-priced web hosting services to an affordable SlickStack-powered cloud server! In fact, many of our former managed hosting customers have moved to independent SlickStack servers, cutting their monthly bill from $39/mo or more to less than $7/mo. Others using our free script have benefited from massive increases to organic traffic and/or noticeable improvement in the speed and stability of their website. We are overjoyed at the many stories that have been shared with our team over the past 4+ years. However, good vibes and positive reviews can only go so far...</p>
        
        <p>For our project to continue as a free and open source application for anyone to use (on an unlimited number of websites!), we need to start generating more donations. If we can't generate more donations soon, we may have to pause or greatly reduce our weekly code contributions to SlickStack to focus more time on consulting. Alternatively, we might be forced to consider other options such as including advertising in WP Admin, converting SlickStack to a "paid" service, or even shutting down the project. Please make 2023 the year that you decide to give back to SlickStack financially so that it can continue to grow and get better... and thank you, ahead of time! &#x1F64F; &#128525;</p>
        
        <p>-- Jesse, SlickStack lead dev</p>
        
        <div style="width:100%;height:auto;border:0px solid #3c434a;padding:0;background:#F1F8E9;">
            <div style="font-size:20px;text-align:left;padding:10px;width:80%;background:#DCEDC8;color:#3c434a;">
                <strong>4/5 sponsors... thank you so much, we are almost there!&nbsp;&nbsp;<a href="https://github.com/sponsors/jessuppi?o=esb" style="text-decoration:underline;"><strong>Sponsor SlickStack for $1/month&nbsp;&raquo;</strong></a></strong>
            </div>
        </div>
        
        <p><em>This message will disappear after we achieve 5 monthly sponsors. — SlickStack</em></p>
        </div>
    
    <?php } else { }

}

// if( is_main_site() || !is_multisite() ) {
//     add_action( 'admin_notices', 'ss_admin_notice_production3' );
// }

function ss_admin_notice_production3() {

    $current_user = wp_get_current_user();
    if ( current_user_can( 'manage_options' ) ) { ?>
    
        <div class="notice notice-info">
        <p><strong>Technical SEO tools (updated)</strong></p>
        <p>Check out the new and improved <a href="?page=slickstack&tab=tools">technical SEO tools</a> that help you keep track of your website's security and performance signals. As search rankings get more competitive, technical SEO signals matter more than ever before.</p>
        
        <p><em>This message will disappear automatically after a few days, thank you. — SlickStack</em></p>
        </div>
    
    <?php } else { }

}

/** ********************************************************************************************* */
/** D. 000 Common: WP Admin Notices (Staging) *************************************************** */
/** ********************************************************************************************* */

/** this is a dynamic notice that is force displayed on the WP Admin backend screen */
/** we use this to announce occasional updates and other critical information */

add_action( 'admin_notices', 'ss_admin_notices_staging' );

function ss_admin_notices_staging() {
    $current_user = wp_get_current_user();
    $environment = WP_ENVIRONMENT_TYPE;
    if ( current_user_can( 'manage_options' ) && $environment == 'staging' ) { ?>
    
        <div class="notice notice-warning">
        <p><strong>Temporary Staging Site Only</strong></p>
        <p>You are now browsing a temporary staging site, created automagically from your live production site. Data is continuously synced every 12 hours and will overwrite existing data (i.e. all staging files/database) unless you <a href="/wp-admin/admin.php?page=slickstack&tab=staging">pause syncing</a>. Please use this staging site to briefly test new plugins, themes, or features, and use the <a href="https://dev.@SITE_DOMAIN_EXCLUDING_WWW">dev site</a> for any long-term redesign projects. Please also note that this staging site shares the <code>/uploads/</code> directory from the production site to save disk space and improve efficiency.</p>
        <p>To avoid potential conflicts or data loss, it is often easier to simply replicate successful "staging" features in production without overwriting things; however, if you do push your staging site live, keep in mind that only the <code>/wp-content/</code> directory and select <a href="/wp-admin/admin.php?page=slickstack&tab=staging#excluded-tables">database tables</a> will be pushed, and nothing else will be transferred (this process will completely overwrite the plugins, themes, and most database tables of your production site). ANY OTHER RANDOM FILES AND FOLDERS WILL BE IGNORED WHEN PUSHING FROM STAGING TO PRODUCTION.</p>
        <p>If you have SSH access, you can run <code>sudo bash /var/www/ss-push-staging</code> from the shell to push this site live, or <a href="/wp-admin/admin.php?page=slickstack&tab=support">ask your agency</a> for assistance.</p>
        <p><em>We will soon have a one-click button to perform this action.</em></p>
        </div>
    
    <?php } else { }
}

/** ********************************************************************************************* */
/** E. 000 Common: WP Admin Notices (Development) *********************************************** */
/** ********************************************************************************************* */

/** this is a dynamic notice that is force displayed on the WP Admin backend screen */
/** we use this to announce occasional updates and other critical information */

add_action( 'admin_notices', 'ss_admin_notices_development' );

function ss_admin_notices_development() {
    $current_user = wp_get_current_user();
    $environment = WP_ENVIRONMENT_TYPE;
    if ( current_user_can( 'manage_options' ) && $environment == 'development' ) { ?>

        <div class="notice notice-warning">
        <p><strong>Standalone Development Site</strong></p>
        <p>This development site is hosted on the same server as your production site, however it uses its own database called <code>development</code> along with its own files (nothing is shared between this site and staging/production). You may use this site for new web design projects without worrying about your work being overwritten. If you wish to install this design (the database, and all files) onto your production site, please review the documentation for <a href="https://slickstack.io/docs/pushing-development-to-production">Pushing Development To Production</a>.</p>
        </div>
    
    <?php } else { }
}

/** ********************************************************************************************* */
/** F. 000 Common: SlickStack Dashboard ********************************************************* */
/** ********************************************************************************************* */

/** this lightweight control panel displays SlickStack settings to admin users only */
/** for ultimate performance none of this data uses MySQL database queries */

// add ss_menu function to admin_menu
function ss_menu() {

    // main slickstack menu item
    add_menu_page(
        'SlickStack Settings',
        'SlickStack',
        'manage_options',
        'slickstack',
        'ss_menu_content', // required
        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KCTxwYXRoIGZpbGw9ImJsYWNrIiBkPSJNMTcuOSw3LjJMMTIuNCAxNy42IDEyLjQgNy45IDguMyA3LjkgMTEuNyAxIDE1LjggMSAxMi44IDcuMiB6IE0xMS43LDguNkw2LjEgMTkgNi4xIDkuMyAyLjEgOS4zIDUuNSAyLjQgOS42IDIuNCA2LjYgOC42IHoiIGZpbGxydWxlPSJldmVub2RkIiBjbGlwcnVsZT0iZXZlbm9kZCI+Cgk8L3BhdGg+Cjwvc3ZnPg==',
        0
    );

	// submenu item: general
	add_submenu_page(
        'slickstack',
        'SlickStack Settings',
        'General',
        'manage_options',
        'slickstack',
        'ss_menu_content'  // required
    );

    // submenu item: sftp details
    add_submenu_page(
        'slickstack',
        'SFTP Details',
        'SFTP Details',
        'manage_options',
        'admin.php?page=slickstack&tab=sftp'
    );

    // submenu item: database access
    add_submenu_page(
        'slickstack',
        'Database Access',
        'Database Access',
        'manage_options',
        'admin.php?page=slickstack&tab=database'
    );

    // submenu item: opcache status
    add_submenu_page(
        'slickstack',
        'OPcache Status',
        'OPcache Status',
        'manage_options',
        'admin.php?page=slickstack&tab=opcache'
    );

    // submenu item: error log
    add_submenu_page(
        'slickstack',
        'Error Log',
        'Error Log',
        'manage_options',
        'admin.php?page=slickstack&tab=error-log'
    );
}

add_action('admin_menu', 'ss_menu', 5); // lower priority to load earlier


// add class to the correct submenu for highlighting
function ss_highlight_active_submenu( $parent_file ) {
    global $submenu_file;

    // check if we are on the slickstack page
    if ( isset( $_GET['page'] ) && $_GET['page'] == 'slickstack' && isset( $_GET['tab'] ) ) {
        $tab = $_GET['tab'];

        // highlight based on the tab parameter
        switch ( $tab ) {
            case 'sftp':
                $submenu_file = 'admin.php?page=slickstack&tab=sftp';
                break;
            case 'database':
                $submenu_file = 'admin.php?page=slickstack&tab=database';
                break;
            case 'opcache':
                $submenu_file = 'admin.php?page=slickstack&tab=opcache';
                break;
            case 'error-log':
                $submenu_file = 'admin.php?page=slickstack&tab=error-log';
                break;
        }
    }

    return $parent_file;
}

add_filter( 'parent_file', 'ss_highlight_active_submenu' );


// generate slickstack dashboard content
 function ss_menu_content() {
    echo '<div class="wrap">
    <h1>SlickStack Settings</h1>';
    
  //Get the active tab from the $_GET param
  $default_tab = null;
  $tab = isset($_GET['tab']) ? $_GET['tab'] : $default_tab;
  
  ?>
  
	<nav class="nav-tab-wrapper">
	<a href="?page=slickstack" class="nav-tab <?php if($tab===null):?>nav-tab-active<?php endif; ?>">General</a>
      
	<?php if(MULTISITE != 'true'){ ?>
	<a href="?page=slickstack&tab=sftp" class="nav-tab <?php if($tab==='sftp'):?>nav-tab-active<?php endif; ?>">SFTP</a>

		<?php if(ADMINER_PUBLIC != 'false'){ ?>
		<a href="?page=slickstack&tab=database" class="nav-tab <?php if($tab==='database'):?>nav-tab-active<?php endif; ?>">Database</a>
		<?php } ?>

	<a href="?page=slickstack&tab=opcache" class="nav-tab <?php if($tab==='opcache'):?>nav-tab-active<?php endif; ?>">OPcache</a>
	<a href="?page=slickstack&tab=error-log" class="nav-tab <?php if($tab==='error-log'):?>nav-tab-active<?php endif; ?>">Error Log</a>
	<a href="?page=slickstack&tab=backups" class="nav-tab <?php if($tab==='backups'):?>nav-tab-active<?php endif; ?>">Backups</a>
	<a href="?page=slickstack&tab=staging" class="nav-tab <?php if($tab==='staging'):?>nav-tab-active<?php endif; ?>">Staging/Dev</a>
	<?php } ?>
      
	<a href="?page=slickstack&tab=billing" class="nav-tab <?php if($tab==='billing'):?>nav-tab-active<?php endif; ?>">Billing</a>
	<a href="?page=slickstack&tab=support" style="float:right;margin-right:0.5em;" class="nav-tab <?php if($tab==='support'):?>nav-tab-active<?php endif; ?>">Get Support</a>
	<a href="?page=slickstack&tab=tools" style="float:right;" class="nav-tab <?php if($tab==='tools'):?>nav-tab-active<?php endif; ?>">SEO Tools</a>
	<a href="?page=slickstack&tab=donate" style="float:right;" class="nav-tab <?php if($tab==='donate'):?>nav-tab-active<?php endif; ?>">Donate</a>
	  
    </nav><!-- nab-tab-wrapper -->

    <div class="tab-content">
	
    <?php switch($tab) :
    
	case 'donate':
	
		echo '<br class="clear" />
		<h2>Donate</h2>
		<p><a href="https://github.com/sponsors/jessuppi" target="_blank" rel="noopener noreferrer"><strong>Sponsor our work</strong></a></p>
		<br class="clear" />';
        
	break;

	case 'support':
	
		echo '<br class="clear" />
		<h2>Community Support</h2>
		<p>This website is running on SlickStack, an open source script for optimizing WordPress cloud servers. To learn more about the project, or to get support from our community, please visit the links below:</p>
		<p><strong>Documentation:</strong> <a href="https://slickstack.io/docs">https://slickstack.io/docs</a></p>
		<p><strong>Support forum (anonymous):</strong> <a href="https://slickstack.io/forum">https://slickstack.io/forum</a></p>
		<p><strong>Report an issue/bug:</strong> <a href="https://github.com/littlebizzy/slickstack/issues/new">https://github.com/littlebizzy/slickstack/issues/new</a></p>
		<p><strong>Email newsletter:</strong> <a href="https://cdn.forms-content.sg-form.com/6ba39413-e148-11ea-b64b-d22850ff1ee7">https://cdn.forms-content.sg-form.com/6ba39413-e148-11ea-b64b-d22850ff1ee7</a></p>
		<p><strong>Discord server:</strong> <a href="https://discord.gg/MC7kzgJdgH">https://discord.gg/MC7kzgJdgH</a></p>
		<br class="clear" />
		<h2>@WHITELABEL_BRAND Support</h2>
		<p>The agency that installed this SlickStack cloud server is also available to assist you. Please contact them using the links below:</p>
		<p><strong>Agency homepage:</strong> <a href="@WHITELABEL_HOMEPAGE">@WHITELABEL_HOMEPAGE</a></p>
		<p><strong>Support requests:</strong> <a href="@WHITELABEL_SUPPORT_URL">@WHITELABEL_SUPPORT_URL</a></p>
		<p><strong>Support email:</strong> <a href="mailto:@WHITELABEL_SUPPORT_EMAIL">@WHITELABEL_SUPPORT_EMAIL</a></p>
		<br class="clear" />';
        
	break;
    
	
	case 'tools':
	
		echo '<br class="clear" />
		<h2>Technical SEO Tools</h2>
		<p>Please use the below free tools to test the security and performance of your website, to get a better idea of your technical SEO signals and reputation. Remember that as search ranking factors become more stringent, it is becoming increasingly important to be aware of what bots (such as these) think about your website. The good news is that SlickStack achieves better scores out-of-the-box than most other web hosting solutions out there!</p>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Security Headers
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/securityheaders.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://securityheaders.com/?q=https://@SITE_FULL_DOMAIN&hide=on&followRedirects=on">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Checks for existing HTTP security headers based on recommendations from top industry experts, including HSTS, Referrer Policy, XSS protection, etc.</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://scotthelme.co.uk/">Scott Helme</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>GTMetrix
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/gtmetrix.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://gtmetrix.com/?url=https://@SITE_FULL_DOMAIN&location=2">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Tests site performance and structure including load time, blocking time, Largest Contentful Paint, Cumulative Layout Shift, with a visual Waterfall.</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.carbon60.com/">Carbon60</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>SSL Labs
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/qualys.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.ssllabs.com/ssltest/analyze.html?d=https://@SITE_FULL_DOMAIN&latest">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Grades your SSL certificate quality by analyzing the CA details, minimum TLS version, cipher keys and OCSP stapling, device handshakes, and more.</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.qualys.com/">Qualys</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>DNSSEC Analyzer
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/verisign.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://dnssec-analyzer.verisignlabs.com/@SITE_ROOT_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.verisign.com/">Verisign Labs</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Mobile-Friendly
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/google.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://search.google.com/test/mobile-friendly?url=https://@SITE_FULL_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/">Google</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Blacklist Check
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/mxtoolbox.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://mxtoolbox.com/SuperTool.aspx?action=blacklist%3a@SITE_ROOT_DOMAIN&run=toolpage">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://mxtoolbox.com/">MxToolbox</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>PageSpeed
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/google.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://pagespeed.web.dev/report?url=https://@SITE_FULL_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/">Google</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>VirusTotal Scan
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/chronicle.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.virustotal.com/gui/search/@SITE_FULL_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://chronicle.security/">Chronicle</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Web Security
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/immuniweb.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.immuniweb.com/websec/?id=@SITE_FULL_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.immuniweb.com/">ImmuniWeb</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>DNS Records
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/nslookup.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.nslookup.io/domains/@SITE_ROOT_DOMAIN/dns-records/">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.nslookup.io/">NsLookup</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>MX Lookup
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/mxtoolbox.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://mxtoolbox.com/SuperTool.aspx?action=mx%3a@SITE_ROOT_DOMAIN&run=toolpage">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://mxtoolbox.com/">MxToolbox</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Email Security
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/easydmarc.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://easydmarc.com/tools/domain-scanner?referred_landing=false&domain=@SITE_ROOT_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>All-in-one email security record scan including DMARC, SPF, DKIM records along with the new BIMI branding authentication record to improve reputation.</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://easydmarc.com/">EasyDMARC</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>IPv6 Health
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/mythicbeasts.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.mythic-beasts.com/ipv6/health-check?domain=@SITE_FULL_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.mythic-beasts.com/">Mythic Beasts</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Transparency
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/google.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://transparencyreport.google.com/copyright/domains/@SITE_ROOT_DOMAIN?hl=en">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Public database of all DMCA and copyright takedown requests submitted to Google companies for your domain including the name of the complainant.</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/">Google</a></cite></p>
			</div>
		</div>
		</div>
		
		<div class="plugin-card">
		<div class="plugin-card-top">
			<div class="name column-name">
			<h3>Legal Complaints
			<img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/lumendatabase.png" class="plugin-icon" alt="">
			</h3>
			</div>
			<div class="action-links">
				<ul class="plugin-action-buttons">
				<li><a class="button" target="_blank" rel="noopener noreferrer" href="https://www.lumendatabase.org/notices/search?utf8=%E2%9C%93&sort_by=date_received+desc&term=@SITE_ROOT_DOMAIN">Run Test</a></li></ul>
			</div>
			<div class="desc column-description">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam...</p>
				<p class="authors"> <cite>By <a target="_blank" rel="noopener noreferrer" href="https://www.lumendatabase.org/">Lumen Database</a></cite></p>
			</div>
		</div>
		</div>';
        
	break;


	case 'opcache':

// inspired by ChatGPT and https://gitlab.com/gnombat/opcachetuner
// Function to render the OPcache Tuner content
function render_opcache_tuner_content() {
    if (!function_exists('opcache_get_status')) {
        echo '<div class="notice notice-error"><p>' . esc_html__('OPcache is not enabled on this server.', 'opcache-tuner') . '</p></div>';
        return;
    }

    // Get OPcache status and configuration
    $opcache_status = opcache_get_status(false);
    $opcache_config = opcache_get_configuration();

    if (!$opcache_status || !$opcache_config) {
        echo '<div class="notice notice-error"><p>' . esc_html__('Failed to retrieve OPcache status or configuration.', 'opcache-tuner') . '</p></div>';
        return;
    }

    // Basic OPcache statistics
    $memory_usage = $opcache_status['memory_usage'];
    $opcache_statistics = $opcache_status['opcache_statistics'];

    echo '<div class="wrap">';
    echo '<h1>' . esc_html__('OPcache Tuner', 'opcache-tuner') . '</h1>';
    
    // General Information
    echo '<h2>' . esc_html__('General Information', 'opcache-tuner') . '</h2>';
    echo '<table class="widefat striped">';
    echo '<tr><th>' . esc_html__('Directive', 'opcache-tuner') . '</th><th>' . esc_html__('Value', 'opcache-tuner') . '</th></tr>';
    echo '<tr><td>' . esc_html__('OPcache Enabled', 'opcache-tuner') . '</td><td>' . ($opcache_config['directives']['opcache.enable'] ? esc_html__('Yes', 'opcache-tuner') : esc_html__('No', 'opcache-tuner')) . '</td></tr>';
    echo '<tr><td>' . esc_html__('Cache Full', 'opcache-tuner') . '</td><td>' . ($opcache_status['cache_full'] ? esc_html__('Yes', 'opcache-tuner') : esc_html__('No', 'opcache-tuner')) . '</td></tr>';
    echo '</table>';
    
    // Memory Usage
    echo '<h2>' . esc_html__('Memory Usage', 'opcache-tuner') . '</h2>';
    echo '<table class="widefat striped">';
    echo '<tr><th>' . esc_html__('Used Memory', 'opcache-tuner') . '</th><td>' . esc_html(size_format($memory_usage['used_memory'])) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Free Memory', 'opcache-tuner') . '</th><td>' . esc_html(size_format($memory_usage['free_memory'])) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Wasted Memory', 'opcache-tuner') . '</th><td>' . esc_html(size_format($memory_usage['wasted_memory'])) . '</td></tr>';
    echo '</table>';

    // Statistics
    echo '<h2>' . esc_html__('Statistics', 'opcache-tuner') . '</h2>';
    echo '<table class="widefat striped">';
    echo '<tr><th>' . esc_html__('Cached Scripts', 'opcache-tuner') . '</th><td>' . esc_html($opcache_statistics['num_cached_scripts']) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Hits', 'opcache-tuner') . '</th><td>' . esc_html($opcache_statistics['hits']) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Misses', 'opcache-tuner') . '</th><td>' . esc_html($opcache_statistics['misses']) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Blacklist Misses', 'opcache-tuner') . '</th><td>' . esc_html($opcache_statistics['blacklist_misses']) . '</td></tr>';
    echo '<tr><th>' . esc_html__('Blacklist Miss Ratio', 'opcache-tuner') . '</th><td>' . esc_html($opcache_statistics['blacklist_miss_ratio']) . '</td></tr>';
    echo '</table>';

    echo '</div>'; // .wrap
}

// Directly call the function to render OPcache information
render_opcache_tuner_content();

	break;


	case 'billing':
	
		echo '<br class="clear" />
		<p>Coming soon... easy automatic billing options for web agencies.</p>';
        
	break;
	
	
	case 'backups':
	
		echo '<br class="clear" />
		<h2>Backup Settings</h2>
		<p>Coming soon... powered by Rclone! Choose from Backblaze, Dropbox, Amazon S3, Google Drive, and more...</p>
		<p>NOTE: remote backups must be configured in your <code>ss-config</code> before using this UI...</p>

            <!-- Remote Backup Form -->
            <form method="post" action="" style="display: inline;">';
        
        	// Output a nonce for form security
        	wp_nonce_field('remote_backup_action', 'remote_backup_nonce');

        	echo '<input type="hidden" name="remote_backup" value="1">
                <input type="submit" class="button" value="Run Remote Backup">
            </form>

		<br class="clear" />
		<h3>Recent Local Backups</h3>
		<br class="clear" />';

        // Handle Run Remote Backup button click
        if (isset($_POST['remote_backup'])) {
            // Verify nonce for security
            if (isset($_POST['remote_backup_nonce']) && wp_verify_nonce($_POST['remote_backup_nonce'], 'remote_backup_action')) {
                
                // Define the FIFO file path
                $fifo_file = '/var/www/meta/command_queue.fifo';

                // Ensure the FIFO file exists and is writable
                if (file_exists($fifo_file) && is_writable($fifo_file)) {
                    // Check if the FIFO file is a named pipe
                    if (posix_mkfifo($fifo_file, 0600) || filetype($fifo_file) == 'fifo') {
                        // Command to run the remote backup
                        $command = '/bin/bash /var/www/ss-remote-backup';

                        // Open the FIFO file in write mode
                        if ($fifo = fopen($fifo_file, 'w')) {
                            // Write the command to the FIFO queue
                            fwrite($fifo, $command . PHP_EOL);
                            fclose($fifo);

                            // Display success message
                            echo '<div class="notice notice-success is-dismissible"><p>Remote backup command added to the queue.</p></div>';
                        } else {
                            echo '<div class="notice notice-error is-dismissible"><p>Failed to open FIFO file for writing.</p></div>';
                        }
                    } else {
                        echo '<div class="notice notice-error is-dismissible"><p>The specified file is not a FIFO file.</p></div>';
                    }
                } else {
                    echo '<div class="notice notice-error is-dismissible"><p>FIFO file is not writable or does not exist.</p></div>';
                }

            } else {
                echo '<div class="notice notice-error is-dismissible"><p>Security check failed. Please try again.</p></div>';
            }
        }
        
	break;
	
	
	case 'staging':
	
		echo '<br class="clear" />
		<h2>Staging/Dev Site Settings</h2>
		<p>To activate staging/dev sites, first enable them in <code>ss-config</code> and then point <code>staging.@SITE_DOMAIN_EXCLUDING_WWW</code> and/or <code>dev.@SITE_DOMAIN_EXCLUDING_WWW</code> to the origin IP address <code>' . SYSTEM_IPV4_ADDRESS . '</code> before running <code>ss-install</code> again.</p>
		<ul class="ul-disc">
		<li>Staging Site: <code>' . STAGING_SITE_STATUS . '</code></li>
		<li>Dev Site: <code>' . DEV_SITE_STATUS . '</code></li>
		<li>Last sync (production to staging): <em>coming soon</em></li>
		<li>Last sync (production to development): <em>coming soon</em></li>
		<li>Last push (staging to production): <em>coming soon</em></li>
		<li>Last push (development to production): <em>coming soon</em></li>
		<li>Auto-sync status: <code>' . SYNC_STAGING_SITE_STATUS . '</code> (ask your agency to pause this if desired)</li>
		<li>Auto-sync interval: coming soon</li>
		</ul>
		<br class="clear" />
		<p>The following functions are installed on all SlickStack staging sites: <em>Disable Emails</em>, <em>Disable WP Cron</em>, and <em>Disable Default Runner (WooCommerce Scheduler)</em>.</p>
		<br class="clear" />';
        
	break;


	case 'sftp':

    if (MULTISITE !== 'true') {

        $ip_server = esc_html($_SERVER['SERVER_ADDR']);
        $sftp_pass = esc_html(SFTP_PASSWORD);
        $sftp_user = esc_html(SFTP_USER);
        $sftp_port = esc_html(SFTP_PORT);

        echo '<br class="clear" />
        <h2>SFTP Details</h2>
        <p>You can use the below credentials to connect to your SlickStack server using SFTP, an encrypted protocol that is powered by SSH. Be sure that you select port 22 and/or SFTP in your client software, and not FTP, FTPS, or otherwise. Although you should not need SFTP for many things, it can be useful for taking backups or to connect third-party backup services, or to disable a WordPress theme or plugin in case of fatal errors.</p>
        <br class="clear" />
        
        <table class="form-table" role="presentation">
            <tr>
                <th scope="row"><label for="sftp-host">SFTP Host:</label></th>
                <td>
                    <input type="text" id="sftp-host" value="' . esc_attr($ip_server) . '" readonly style="width: 200px;" aria-label="SFTP Host">
                    <button type="button" class="button" onclick="copyToClipboard(\'sftp-host\')" aria-label="Copy SFTP Host">Copy</button>
                </td>
            </tr>
            <tr>
                <th scope="row"><label for="sftp-user">SFTP User:</label></th>
                <td>
                    <input type="text" id="sftp-user" value="' . esc_attr($sftp_user) . '" readonly style="width: 200px;" aria-label="SFTP User">
                    <button type="button" class="button" onclick="copyToClipboard(\'sftp-user\')" aria-label="Copy SFTP User">Copy</button>
                </td>
            </tr>
            <tr>
                <th scope="row"><label for="sftp-password">SFTP Password:</label></th>
                <td>
                    <input type="password" id="sftp-password" value="' . esc_attr($sftp_pass) . '" readonly style="width: 200px;" aria-label="SFTP Password">
                    <button type="button" class="button" onclick="togglePasswordVisibility()" aria-label="Show or Hide Password">Show/Hide</button>
                    <button type="button" class="button" onclick="copyToClipboard(\'sftp-password\')" aria-label="Copy SFTP Password">Copy</button>
                </td>
            </tr>
            <tr>
                <th scope="row"><label for="sftp-port">SFTP Port:</label></th>
                <td>
                    <input type="text" id="sftp-port" value="' . esc_attr($sftp_port) . '" readonly style="width: 200px;" aria-label="SFTP Port">
                    <button type="button" class="button" onclick="copyToClipboard(\'sftp-port\')" aria-label="Copy SFTP Port">Copy</button>
                </td>
            </tr>
            <tr>
                <th scope="row"><label for="root-directory">Root Directory:</label></th>
                <td>
                    <input type="text" id="root-directory" value="/var/www" readonly style="width: 200px;" aria-label="Root Directory">
                    <button type="button" class="button" onclick="copyToClipboard(\'root-directory\')" aria-label="Copy Root Directory">Copy</button>
                </td>
            </tr>
            <tr>
                <th scope="row"><label for="public-directory">Public Directory:</label></th>
                <td>
                    <input type="text" id="public-directory" value="/var/www/html" readonly style="width: 200px;" aria-label="Public Directory">
                    <button type="button" class="button" onclick="copyToClipboard(\'public-directory\')" aria-label="Copy Public Directory">Copy</button>
                </td>
            </tr>
        </table>
        
        <br class="clear" />
        <p>
            <!-- Reset SFTP Password Form -->
            <form method="post" action="" style="display: inline;">
                ';
        
        // Output a nonce for form security
        wp_nonce_field('reset_sftp_password_action', 'reset_sftp_password_nonce');

        echo '
                <input type="hidden" name="reset_sftp_password" value="1">
                <input type="submit" class="button" value="Reset SFTP Password">
            </form>

            <!-- Test Connection Form -->
            <form method="post" action="" style="display: inline;">
                ';
        
        // Output a nonce for form security
        wp_nonce_field('test_sftp_connection_action', 'test_sftp_connection_nonce');

        echo '
                <input type="hidden" name="test_sftp_connection" value="1">
                <input type="submit" class="button" value="Test SFTP Connection">
            </form>
        </p>

        <script>
        function togglePasswordVisibility() {
            var passwordField = document.getElementById("sftp-password");
            if (passwordField.type === "password") {
                passwordField.type = "text";
                setTimeout(function() {
                    passwordField.type = "password";
                }, 10000); // Hide password after 10 seconds for better security
            } else {
                passwordField.type = "password";
            }
        }

        function copyToClipboard(elementId) {
            var copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            navigator.clipboard.writeText(copyText.value).then(function() {
                alert(elementId.replace(/-/g, " ") + " copied to clipboard!");
            }).catch(function(error) {
                alert("Failed to copy " + elementId.replace(/-/g, " ") + ": " + error);
            });
        }
        </script>';

        // Handle Reset SFTP Password button click
        if (isset($_POST['reset_sftp_password'])) {
            // Verify nonce for security
            if (isset($_POST['reset_sftp_password_nonce']) && wp_verify_nonce($_POST['reset_sftp_password_nonce'], 'reset_sftp_password_action')) {
                
                // Define the FIFO file path
                $fifo_file = '/var/www/meta/command_queue.fifo';

                // Ensure the FIFO file exists and is writable
                if (file_exists($fifo_file) && is_writable($fifo_file)) {
                    // Check if the FIFO file is a named pipe
                    if (posix_mkfifo($fifo_file, 0600) || filetype($fifo_file) == 'fifo') {
                        // Command to reset the SFTP password
                        $command = '/bin/bash /var/www/ss-reset-password-sftp';

                        // Open the FIFO file in write mode
                        if ($fifo = fopen($fifo_file, 'w')) {
                            // Write the command to the FIFO queue
                            fwrite($fifo, $command . PHP_EOL);
                            fclose($fifo);

                            // Display success message
                            echo '<div class="notice notice-success is-dismissible"><p>SFTP password reset command added to the queue.</p></div>';
                        } else {
                            echo '<div class="notice notice-error is-dismissible"><p>Failed to open FIFO file for writing.</p></div>';
                        }
                    } else {
                        echo '<div class="notice notice-error is-dismissible"><p>The specified file is not a FIFO file.</p></div>';
                    }
                } else {
                    echo '<div class="notice notice-error is-dismissible"><p>FIFO file is not writable or does not exist.</p></div>';
                }

            } else {
                echo '<div class="notice notice-error is-dismissible"><p>Security check failed. Please try again.</p></div>';
            }
        }

        // Handle Test Connection button click
        if (isset($_POST['test_sftp_connection'])) {
            // Verify nonce for security
            if (isset($_POST['test_sftp_connection_nonce']) && wp_verify_nonce($_POST['test_sftp_connection_nonce'], 'test_sftp_connection_action')) {
                if (current_user_can('manage_options')) {
                    // Handle errors more explicitly rather than suppressing them
                    $connection = ssh2_connect($ip_server, $sftp_port);
                    if (!$connection) {
                        echo '<div class="notice notice-error is-dismissible"><p>Unable to establish connection. Please check your server settings.</p></div>';
                    } else if (ssh2_auth_password($connection, $sftp_user, SFTP_PASSWORD)) {
                        echo '<div class="notice notice-success is-dismissible"><p>SFTP connection successful!</p></div>';
                    } else {
                        echo '<div class="notice notice-error is-dismissible"><p>Failed to authenticate. Please check your credentials and try again.</p></div>';
                    }

                    // Close the connection if it was established
                    if ($connection) {
                        unset($connection); // No explicit ssh2_disconnect() function
                    }
                } else {
                    echo '<div class="notice notice-error is-dismissible"><p>You do not have permission to test the SFTP connection.</p></div>';
                }
            } else {
                echo '<div class="notice notice-error is-dismissible"><p>Security check failed. Please try again.</p></div>';
            }
        }

    } // end if

    break;


	case 'database':
		
    	echo '<br class="clear" />
		<h2>Database Access</h2>
		<p>SlickStack bundles the open source Adminer script, which is a lightweight alternative to phpMyAdmin. You can use the below credentials to login and manage your database(s) using the Adminer panel, even if you are using a remote database server. If you would rather disable Adminer, simply change the value of <code>ADMINER_PUBLIC</code> to be <code>false</code> in your ss-config file and then reinstall SlickStack again.</p>
		<br class="clear" />
		<p><strong>Database Host:</strong> <code>' . DB_HOST . '</code></p>
		<p><strong>Database Name:</strong> <code>' . DB_NAME . '</code></p>
		<p><strong>Database User:</strong> <code>' . DB_USER . '</code></p>
		<p><strong>Database Password:</strong> <code><span class="password blur">' . DB_PASSWORD . '</span></code><span style="margin-left:2px" class="toggle-password showme dashicons dashicons-visibility"></span></p>
		<br class="clear" />
		<p><a class="button" href="https://@SITE_FULL_DOMAIN/@ADMINER_RANDOM_URL/?username=' . DB_USER . '&db=' . DB_NAME . '&server=' . DB_HOST . '" target="_blank" rel="noopener noreferrer">Launch Adminer (new tab)</a></p>
		<br class="clear" />
		<p><strong>Note:</strong> Newer versions of MySQL no longer support root users. Instead, you can use the <code>admin@127.0.0.1</code> pseudo-root user if you need elevated privileges (applies to localhost databases only).</p>


		<style>
		.blur {
			filter: blur(3px);
		}
		.unblur {
			filter: blur(0);
		}
		</style>

		<script>(function($) {
		$(".toggle-password").click(function() {
  		$(".showme").toggleClass("dashicons-visibility dashicons-hidden");
 		$(".password").toggleClass("blur unblur");
		});
		})( jQuery );</script>';
        
	break;
	
case 'error-log':

    echo '<br class="clear" />
        <h2>Error Log</h2>
        <p>Below are the most recent (<em>E_ERROR</em>, <em>E_WARNING</em>, <em>E_PARSE</em>) lines from the PHP-FPM error log: <code>/var/www/logs/php-error.log</code></p>
        <p>Keep in mind that production, staging, and development all share the same error log, which can be helpful if one of your environments has a fatal error or white screen of death (WSOD). However, only staging and development have <code>WP_DEBUG_LOG</code> enabled, meaning you can find a verbose (<em>E_ALL</em>) debug log under <code>/wp-content/debug.log</code> on both of those environments.</p>
		<br class="clear" />';

    // Check if the form has been submitted to clear the log
    if (isset($_POST['clearlog'])) {
        if (current_user_can('manage_options')) {
            $logpath = '/var/www/logs/php-error.log';

            if (file_exists($logpath)) {
                // Clear the error log file
                file_put_contents($logpath, '');

                // Confirm the log was cleared
                echo '<div class="notice notice-success"><p>Error log cleared successfully!</p></div>';
            } else {
                echo '<div class="notice notice-error"><p>Error log file not found.</p></div>';
            }
        } else {
            // If the user doesn't have the correct permissions
            echo '<div class="notice notice-error"><p>You do not have permission to clear the log.</p></div>';
        }
    }

    // Function to read the last lines of the error log
    function last_lines($file, $lines) {
        $size = filesize($file);
        $fd = fopen($file, 'r');
        $pos = $size;
        $n = 0;

        while ($n < $lines + 1 && $pos > 0) {
            fseek($fd, $pos);
            $a = fread($fd, 1);
            if ($a === "\n") {
                ++$n;
            }
            $pos--;
        }

        $ret = [];
        while (($line = fgets($fd)) !== false) {
            $ret[] = $line;
        }

        fclose($fd);

        return array_reverse($ret);
    }

    // Handle the Download Error Log button functionality
    if (isset($_POST['download_php_error_log'])) {
        if (current_user_can('manage_options')) {
            $error_log_file = ini_get('error_log');

            if (file_exists($error_log_file)) {
                // Set headers for the download
                header('Content-Type: text/plain');
                header('Content-Disposition: attachment; filename="php_error_log.txt"');
                header('Content-Length: ' . filesize($error_log_file));

                // Clear output buffer
                ob_clean();
                flush();

                // Read the file and output to browser
                readfile($error_log_file);
                exit;
            } else {
                echo '<div class="notice notice-error"><p>Error log file not found.</p></div>';
            }
        } else {
            echo '<div class="notice notice-error"><p>You do not have permission to download the log.</p></div>';
        }
    }

    // Display the log contents
    $logpath = '/var/www/logs/php-error.log';
    if (file_exists($logpath)) {
        echo '<div style="overflow-x: auto; background: rgba(0,0,0,.07);"><pre style="padding: 3px 5px 2px; margin: 0 1px;">';
        echo esc_html(implode('', last_lines($logpath, 999)));
        echo '</pre></div>';
    } else {
        echo '<div class="notice notice-error"><p>Error log file not found.</p></div>';
    }
    ?>

    <br class="clear" />
    <p>
        <!-- The form action is the same page, so it will reload after submission -->
        <form action="" method="post" style="display: inline;">
            <input type="submit" name="clearlog" class="button" value="Clear Error Log">
        </form>

        <!-- Add HTML for the Download Error Log button -->
        <form method="post" style="display: inline;">
            <input type="hidden" name="download_php_error_log" value="1">
            <input type="submit" class="button" value="Download Error Log">
        </form>
    </p>
    
    <?php

    break;


	default:
		
		$ss_os = PHP_OS_FAMILY;
		
		$ss_cpu = 1;
		if(is_file('/proc/cpuinfo')) {
    		$cpuinfo = file_get_contents('/proc/cpuinfo');
    		preg_match_all('/^processor/m', $cpuinfo, $matches);
    		$ss_cpu = count($matches[0]);
		}
      
        echo '<div style="display: flex; width: 100%; box-sizing: border-box; margin: 0; padding: 0; align-items: stretch;">
    	<div class="card" style="flex-grow: 1; flex-basis: 60% !important; max-width: 60% !important; margin-right: 10px; box-sizing: border-box;">
        <h2 class="title">Welcome to SlickStack!</h2>
        <p>SlickStack is an open source LEMP stack script for KVM cloud servers, based on several years of research and thousands of hours of coding, designed to improve the speed, security, and stability of your WordPress website.</p>
        <p>Because our software stack includes server-level Nginx page cache, Memcached object cache, and PHP OPcache, there is no need to install additional WordPress cache plugins or AMP features when using SlickStack. In addition, several security settings are hardcoded into our configuration, such as anti-brute force (rate-limiting) and blocking of sensitive URLs, meaning that security plugins are not very beneficial, and may in fact cause conflicts.</p>
        <p>Our long-term dream is to help decentralize more of the web hosting industry, while empowering local datacenters and web agencies. By achieving market-leading performance metrics and technical SEO signals, paired with incredibly affordable pricing and personalized customer support, we hope you reach out to these independent businesses for future maintenance and any consulting needs.</p>
        <p>Thanks for being part of our community, and we welcome all feedback...</p>
        <p>&nbsp;</p>
        <p>Sincerely,<br><br>Jesse<br>Lead Developer</p>
        <p>&nbsp;</p>
        <p><em>Has SlickStack helped you? Please leave a public review:</em></p>
        <p>
            <a href="https://www.g2.com/products/slickstack/reviews"><img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/g2crowd.svg" height="30px" style="margin-right: 20px;" class="reviews-icon" alt=""></a>
            <a href="https://www.capterra.com/p/211436/SlickStack"><img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/capterra.svg" height="30px" style="margin-right: 20px;" class="reviews-icon" alt=""></a>
            <a href="https://sourceforge.net/software/product/SlickStack/"><img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/sourceforge.svg" height="30px" style="margin-right: 20px;" class="reviews-icon" alt=""></a>
            <a href="https://www.producthunt.com/posts/slickstack"><img src="https://raw.githubusercontent.com/littlebizzy/slickstack/master/assets/images/producthunt.svg" height="30px" style="margin-right: 20px;" class="reviews-icon" alt=""></a>
        </p>
    </div>';

    // Define the directory where timestamp files are stored
    $timestamp_dir = '/var/www/meta/timestamps/';

    // Ensure the directory exists
    if (is_dir($timestamp_dir)) {
        // Scan the directory and get the list of files
        $files = scandir($timestamp_dir);

        // Initialize an array to store the file modification times
        $file_times = array();

        // Loop through the files
        foreach ($files as $file) {
            // Skip '.' and '..'
            if ($file !== '.' && $file !== '..') {
                // Get the full path to the file
                $file_path = $timestamp_dir . $file;

                // Get the file's last modification time
                $file_mtime = filemtime($file_path);

                // Add the file and its modification time to the array
                $file_times[$file] = $file_mtime;
            }
        }

        // Sort the files by modification time, most recent first
        arsort($file_times);

        // Display the files in the dark box with vertical and horizontal scrolling
        echo '<div class="card" style="flex-basis: 40% !important; max-width: 40% !important; background-color: #333; color: #ffffff; box-sizing: border-box; overflow-y: auto; overflow-x: auto;">';
        echo '<h3 style="color: #ffffff !important;">Recent Bash Commands</h3>';
        echo '<p style="color: #cccccc;">Below are the most recent bash scripts executed on the server, based on their last modified timestamps. Tracking these scripts helps monitor server activity and debug issues.</p>';
        echo '<div style="white-space: nowrap; flex-grow: 1;">';

        // Show the 10 most recent bash scripts
        $count = 0;
        foreach ($file_times as $file => $mtime) {
            if ($count < 10) {
                // Format the modification time
                $formatted_time = esc_html(date('Y-m-d H:i:s', $mtime));
                echo '<p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">' . esc_html($file) . ' - ' . $formatted_time . '</p>';
                $count++;
            }
        }

        echo '</div>'; // Close scroll container
        echo '</div>';
    } else {
        echo '<div class="card" style="flex-grow: 0; flex-basis: 40% !important; max-width: 40% !important; background-color: #333; color: #ffffff; box-sizing: border-box;">';
        echo '<h3 style="color: #ffffff !important;">Recent Bash Scripts</h3>';
        echo '<p>No bash script timestamps found.</p>';
        echo '</div>';
    }

	echo '</div>';

        
		break;
		
    endswitch; ?>
    </div><!-- tab-content -->

    <?php echo '</div><!-- wrap -->';
}

/** ********************************************************************************************* */
/** G. 000-Common: Disk Space Warning (WP Admin Notice) ***************************************** */
/** ********************************************************************************************* */

/** this hardcoded notice will appear when server disk space is beginning to run out */
/** it will be red if more than 90% used and yellow if more than 80% used */

$disk_used_percent_now = SYSTEM_DISK_USED_PERCENT;
$disk_used_percent_now_cleaner = trim( $disk_used_percent_now, '%' );

if ( (int) $disk_used_percent_now_cleaner >= 90 ) {
	add_action( 'admin_notices', 'ss_notices_disk_space_90' );
} elseif ( (int) $disk_used_percent_now_cleaner >= 85 ) {
	add_action( 'admin_notices', 'ss_notices_disk_space_85' );
}

// more than 90% used
function ss_notices_disk_space_90() {
	$current_user = wp_get_current_user();
	if ( current_user_can( 'manage_options' ) ) { ?>
		<div class="notice notice-error">
			<p><strong>Disk Space Warning</strong></p>
			<p>Server disk space is running out with 
				<a href="/wp-admin/admin.php?page=slickstack">
					<?php
					$disk_used_percent_notice_90 = SYSTEM_DISK_USED_PERCENT;
					echo esc_html( $disk_used_percent_notice_90 );
					?> currently used
				</a>; please consider upgrading your server, adding additional block storage to this server, and/or deleting any files and folders that are not required by your website.
			</p>
			<p><em>This message will disappear after sufficient free space exists, thank you. — SlickStack</em></p>
		</div>
	<?php
	}
}

// more than 85% used
function ss_notices_disk_space_85() {
	$current_user = wp_get_current_user();
	if ( current_user_can( 'manage_options' ) ) { ?>
		<div class="notice notice-warning">
			<p><strong>Disk Space Warning</strong></p>
			<p>Server disk space is running out with 
				<a href="/wp-admin/admin.php?page=slickstack">
					<?php
					$disk_used_percent_notice_85 = SYSTEM_DISK_USED_PERCENT;
					echo esc_html( $disk_used_percent_notice_85 );
					?> currently used
				</a>; please consider upgrading your server, adding additional block storage to this server, and/or deleting any files and folders that are not required by your website.
			</p>
			<p><em>This message will disappear after sufficient free space exists, thank you. — SlickStack</em></p>
		</div>
	<?php
	}
}

/** ********************************************************************************************* */
/** H. 000-Common: PHP Hacks Warning (WP Admin Notice) ****************************************** */
/** ********************************************************************************************* */

// if plugin or theme files found to be hacking PHP ini or error handling settings

/** ********************************************************************************************* */
/** I. 000-Common: Switch Environment Menu ****************************************************** */
/** ********************************************************************************************* */

/** this small drop-down menu lets you easily switch between enabled environments */
/** links will be hidden in case certain environments have been disabled */

// add action
add_action( 'admin_bar_menu', 'ss_environment_menu', 25 );

// ss_environment_menu function
function ss_environment_menu( $admin_bar ) {

    $current_user                = wp_get_current_user();
    $ss_production_link          = '@SITE_FULL_DOMAIN';
    $ss_staging_link             = 'staging.@SITE_DOMAIN_EXCLUDING_WWW';
    $ss_dev_link                 = 'dev.@SITE_DOMAIN_EXCLUDING_WWW';
    $actual_link                 = "https://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
    $actual_link_staging_to_production = str_replace( $ss_staging_link, $ss_production_link, $actual_link );
    $actual_link_staging_to_dev       = str_replace( $ss_staging_link, $ss_dev_link, $actual_link );
    $actual_link_dev_to_production    = str_replace( $ss_dev_link, $ss_production_link, $actual_link );
    $actual_link_dev_to_staging       = str_replace( $ss_dev_link, $ss_staging_link, $actual_link );
    $actual_link_production_to_dev    = str_replace( $ss_production_link, $ss_dev_link, $actual_link );
    $actual_link_production_to_staging = str_replace( $ss_production_link, $ss_staging_link, $actual_link );

    if ( current_user_can( 'manage_options' ) ) {

        // staging site drop-down menu
        if ( WP_ENVIRONMENT_TYPE == 'staging' ) {

            // current environment
            $admin_bar->add_menu( array(
                'parent' => 'top-secondary',
                'id'     => 'ss_environment_current',
                'title'  => '<span style="color:#FFBA00;">STAGING ONLY</span>',
                'href'   => false,
            ) );

            // production (required)
            $admin_bar->add_menu( array(
                'parent' => 'ss_environment_current',
                'id'     => 'ss_environment_toggle_production',
                'title'  => 'Switch To Production',
                'href'   => $actual_link_staging_to_production,
                'meta'   => array( 'target' => '_blank' ),
            ) );

            // dev (if enabled)
            if ( DEV_SITE_STATUS == 'true' ) {
                $admin_bar->add_menu( array(
                    'parent' => 'ss_environment_current',
                    'id'     => 'ss_environment_toggle_dev',
                    'title'  => 'Switch To Dev',
                    'href'   => $actual_link_staging_to_dev,
                    'meta'   => array( 'target' => '_blank' ),
                ) );
            }

        } // end staging site drop-down menu


        // dev site drop-down menu
        elseif ( WP_ENVIRONMENT_TYPE == 'development' ) {

            // current environment
            $admin_bar->add_menu( array(
                'parent' => 'top-secondary',
                'id'     => 'ss_environment_current',
                'title'  => '<span style="color:#FFBA00;">DEVELOPMENT</span>',
                'href'   => false,
            ) );

            // production (required)
            $admin_bar->add_menu( array(
                'parent' => 'ss_environment_current',
                'id'     => 'ss_environment_toggle_production',
                'title'  => 'Switch To Production',
                'href'   => $actual_link_dev_to_production,
                'meta'   => array( 'target' => '_blank' ),
            ) );

            // staging (if enabled)
            if ( STAGING_SITE_STATUS == 'true' ) {
                $admin_bar->add_menu( array(
                    'parent' => 'ss_environment_current',
                    'id'     => 'ss_environment_toggle_dev',
                    'title'  => 'Switch To Staging',
                    'href'   => $actual_link_dev_to_staging,
                    'meta'   => array( 'target' => '_blank' ),
                ) );
            }

        } // end dev site drop-down menu


        // production site drop-down menu
        else {

            // current environment
            $admin_bar->add_menu( array(
                'parent' => 'top-secondary',
                'id'     => 'ss_environment_current',
                'title'  => '<span style="color:#3CB54C;">PRODUCTION</span>',
                'href'   => false,
            ) );

            // staging (if enabled)
            if ( STAGING_SITE_STATUS == 'true' ) {
                $admin_bar->add_menu( array(
                    'parent' => 'ss_environment_current',
                    'id'     => 'ss_environment_toggle_staging',
                    'title'  => 'Switch To Staging',
                    'href'   => $actual_link_production_to_staging,
                    'meta'   => array( 'target' => '_blank' ),
                ) );
            }

            // dev (if enabled)
            if ( DEV_SITE_STATUS == 'true' ) {
                $admin_bar->add_menu( array(
                    'parent' => 'ss_environment_current',
                    'id'     => 'ss_environment_toggle_dev',
                    'title'  => 'Switch To Dev',
                    'href'   => $actual_link_production_to_dev,
                    'meta'   => array( 'target' => '_blank' ),
                ) );
            }

        } // end production site drop-down menu

    } else { }
}

/** ********************************************************************************************* */
/** J. 000-Common: WP Admin Toolbar Menu ******************************************************** */
/** ********************************************************************************************* */

add_action( 'admin_bar_menu', 'slickstack_menu', 999 ); // low priority to load on the right of other potential drop-down menus

function slickstack_menu() {
    if ( current_user_can( 'manage_options' ) ) {
        global $wp_admin_bar;

        $wp_admin_bar->add_menu( array(
            'parent' => 'top-secondary', // Adds it to the right side, near user profile
            'id'     => 'ss-menu-main',
            'title'  => 'SlickStack',
            'href'   => false,
            'meta'   => array( 'position' => 99, 'class' => 'slickstack-menu' ), // Position to the right
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-sftp',
            'title'  => 'SFTP Details',
            'href'   => admin_url( 'admin.php?page=slickstack&tab=sftp' ),
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-database',
            'title'  => 'Database Access',
            'href'   => admin_url( 'admin.php?page=slickstack&tab=database' ),
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-opcache',
            'title'  => 'OPcache Status',
            'href'   => admin_url( 'admin.php?page=slickstack&tab=opcache' ),
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-error-log',
            'title'  => 'Error Log',
            'href'   => admin_url( 'admin.php?page=slickstack&tab=error-log' ),
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-reviews-g2-crowd',
            'title'  => 'Review on G2 Crowd',
            'href'   => 'https://www.g2.com/products/slickstack/reviews',
            'meta'   => array( 'target' => '_blank' )
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-reviews-capterra',
            'title'  => 'Review on Capterra',
            'href'   => 'https://www.capterra.com/p/211436/SlickStack/',
            'meta'   => array( 'target' => '_blank' )
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-reviews-producthunt',
            'title'  => 'Review on Product Hunt',
            'href'   => 'https://www.producthunt.com/posts/slickstack',
            'meta'   => array( 'target' => '_blank' )
        ) );

        $wp_admin_bar->add_menu( array(
            'parent' => 'ss-menu-main',
            'id'     => 'ss-menu-reviews-sourceforge',
            'title'  => 'Review on SourceForge',
            'href'   => 'https://sourceforge.net/software/product/SlickStack/',
            'meta'   => array( 'target' => '_blank' )
        ) );
    }
}

/** ********************************************************************************************* */
/** SlickStack: External References Used To Improve This Script (Thanks, Interwebz) ************* */
/** ********************************************************************************************* */

// Ref: ChatGPT
// Ref: https://www.digitalocean.com/community/questions/enable-php-5-5-opcache-on-ubuntu-14-04-with-nginx-and-php-fpm
// Ref: https://stackoverflow.com/questions/15025875/what-is-the-best-way-in-php-to-read-last-lines-from-a-file
// Ref: https://stackoverflow.com/questions/4948663/php-get-bool-to-echo-false-when-false
// Ref: https://core.trac.wordpress.org/ticket/51086
// Ref: https://github.com/stevegrunwell/wp-admin-tabbed-settings-pages
// Ref: https://wordpress.stackexchange.com/questions/84200/how-to-change-default-icon-of-custom-plugin
// Ref: https://wordpress.stackexchange.com/questions/311412/how-can-i-make-my-admin-icon-svg-color-correctly
// Ref: https://stackoverflow.com/questions/30620226/custom-svg-admin-menu-icon-in-wordpress
// Ref: https://developer.wordpress.org/reference/functions/add_menu_page/
// Ref: https://second-cup-of-coffee.com/using-an-svg-icon-for-a-wordpress-custom-post-type/
// Ref: https://stackoverflow.com/questions/53246094/how-do-i-convert-multi-path-svg-to-one-path
// Ref: https://graphicdesign.stackexchange.com/questions/27312/illustrator-make-paths-as-a-compound-path
// Ref: https://graphicdesign.stackexchange.com/questions/71506/how-to-generate-a-single-path-for-a-svg-using-illustrator
// Ref: https://stackoverflow.com/questions/68100124/get-a-single-path-value-for-svg-file-having-multiple-paths
// Ref: https://jsfiddle.net/kirillbelyaev/u88m7fa2/
// Ref: https://gist.github.com/andytlr/9283541
// Ref: https://github.com/palantir/blueprint/issues/2389
// Ref: https://stackoverflow.com/questions/29110399/how-to-edit-the-contents-of-a-file-on-button-click-php
// Ref: https://digwp.com/2016/05/wordpress-admin-notices/
// Ref: https://stackoverflow.com/questions/15001353/remove-characters-from-a-variable
// Ref: https://stackoverflow.com/questions/54865119/php-if-greater-than
// Ref: https://wordpress.stackexchange.com/questions/229228/init-action-and-refresh-page-after-form-action
// Ref: https://wordpress.stackexchange.com/questions/229139/how-to-properly-refresh-page-after-form-action
// Ref: https://stackoverflow.com/questions/21843830/clear-form-after-submit-and-page-refresh-wordpress
// Ref: https://github.com/woocommerce/woocommerce/wiki/Database-Description
// Ref: https://github.com/littlebizzy/slickstack/issues/121
// Ref: https://stackoverflow.com/questions/6768793/get-the-full-url-in-php
// Ref: https://stackoverflow.com/questions/44200823/how-to-mask-parts-of-a-string-with-the-asterisk-character
// Ref: https://gist.github.com/nawawi/ae2506f486672b7ce979895cd124c584
// Ref: https://gist.github.com/nawawi/ec01e902bbb6a2fed3c09df03f383976

// SS_EOF
